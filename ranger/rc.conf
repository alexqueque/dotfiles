set viewmode miller

set column_ratios 1,3,4

set hidden_filter ^\.|\.(?:pyc|pyo|bak|swp)$|^lost\+found$|^__(py)?cache__$

set show_hidden true

set confirm_on_delete always

set use_preview_script true

set automatically_count_files true

set open_all_images true

set vcs_aware true
set vcs_msg_length 50
set vcs_backend_git enabled
set vcs_backend_hg  disabled
set vcs_backend_bzr disabled
set vcs_backend_svn disabled

set preview_images true
set preview_images_method kitty

set unicode_ellipsis false

set show_hidden_bookmarks true

set colorscheme dracula

set preview_files true
set preview_directories true
set collapse_preview true

set wrap_plaintext_previews true

set save_console_history true

set draw_progress_bar_in_status_bar true

set draw_borders separators

set dirname_in_tabs true

set mouse_enabled true

set display_size_in_main_column true
set display_size_in_status_bar true
set display_free_space_in_status_bar true
set display_tags_in_all_columns true

set update_title true
set update_tmux_title true
set shorten_title 3

set hostname_in_titlebar false

set tilde_in_titlebar true

set max_history_size 20
set max_console_history_size 50

set scroll_offset 8

set flushinput true

set padding_right true

set autosave_bookmarks true

set save_backtick_bookmark true

set autoupdate_cumulative_size true

set sort mtime

set sort_reverse false
set sort_case_insensitive true
set sort_directories_first true
set sort_unicode false

set cd_bookmarks true

set cd_tab_case smart

set cd_tab_fuzzy true

set hint_collapse_threshold 5

set show_selection_in_titlebar false

set idle_delay 1000

set nested_ranger_warning true

# ===================================================================
# == Command Aliases in the Console
# ===================================================================

alias q     quit
alias q!    quit!
alias qa    quitall
alias qa!   quitall!

alias filter     scout -prts
alias find       scout -aets
alias mark       scout -mr
alias unmark     scout -Mr
alias search     scout -rs
alias search_inc scout -rts

# ===================================================================
# == Define keys for the browser
# ===================================================================

# Basic
map     q quit
map     Q quitall

map <ESC> change_mode normal
map <C-r> chain reset; reload_cwd
map <C-s> set viewmode!

map <Space> display_file
map <C-u> scroll_preview 5
map <C-e> scroll_preview -5
map w taskview_open
map W display_log
map S shell $SHELL

map ;  console
map !  console shell%space
map @  console -p6 shell  %%s
map #  console shell -p%space
map o  chain draw_possible_programs; console open_with%space
map f  console filter%space
map cd console cd%space

map <C-p> chain console; eval fm.ui.console.history_move(-1)

# Change the line mode
map mn linemode filename
map mp linemode permissions
map mm linemode humanreadablemtime
map mM linemode mtime
map ms linemode sizemtime
map mS linemode sizehumanreadablemtime

# Tagging / Marking
map t       tag_toggle
map T<any>  tag_toggle tag=%any
map <CR>    mark_files toggle=True
map v       toggle_visual_mode
map V       toggle_visual_mode reverse=True

# VIM-like
map u  move up=1
map U  move up=5
map e  move down=1
map E  move down=5
map n  move left=1
map i  move right=1
map gg move to=0
map G  move to=-1

# Jumping around
map [     move_parent -1
map ]     move_parent 1
map {     history_go -1
map }     history_go 1
map ,     jump_non

map gh cd ~

# External Programs
map k  edit
map yy yank path
map yY yank dir
map Yy yank name
map YY yank name_without_extension

# Filesystem Operations
map r rename_append -r
map a rename_append
map A eval fm.open_console('rename ' + fm.thisfile.relative_path.replace("%", "%%"))
map K eval fm.open_console('rename ' + fm.thisfile.relative_path.replace("%", "%%"), position=7)

map p paste
map P paste overwrite=True

map dt console trash
map dd cut mode=toggle

map yy copy mode=toggle

# Temporary workarounds
map dgg eval fm.cut(dirarg=dict(to=0), narg=quantifier)
map dG  eval fm.cut(dirarg=dict(to=-1), narg=quantifier)
map du  eval fm.cut(dirarg=dict(up=1), narg=quantifier)
map de  eval fm.cut(dirarg=dict(down=1), narg=quantifier)
map ygg eval fm.copy(dirarg=dict(to=0), narg=quantifier)
map yG  eval fm.copy(dirarg=dict(to=-1), narg=quantifier)
map yu  eval fm.copy(dirarg=dict(up=1), narg=quantifier)
map ye  eval fm.copy(dirarg=dict(down=1), narg=quantifier)

# Searching
map /  console search%space
map -  search_next
map =  search_next forward=False

# Tabs
map <C-t>     tab_new
# map <C-w>     tab_close
map <C-n>     tab_move -1
map <C-i>     tab_move 1
map <C-1>     tab_open 1
map <C-2>     tab_open 2
map <C-3>     tab_open 3

# Sorting
map ss chain set sort=size;      set sort_reverse=False
map sS chain set sort=size;      set sort_reverse=True
map sn chain set sort=basename;  set sort_reverse=False
map sN chain set sort=basename;  set sort_reverse=True
map sm chain set sort=mtime;     set sort_reverse=False
map sM chain set sort=mtime;     set sort_reverse=True
map sc chain set sort=ctime;     set sort_reverse=False
map sC chain set sort=ctime;     set sort_reverse=True
map sa chain set sort=atime;     set sort_reverse=False
map sA chain set sort=atime;     set sort_reverse=True
map st chain set sort=type;      set sort_reverse=False
map sT chain set sort=type;      set sort_reverse=True
map se chain set sort=extension; set sort_reverse=False
map sE chain set sort=extension; set sort_reverse=True

# map dc get_cumulative_size

# Settings
map <C-h> set show_hidden!

# Filter stack
map .d filter_stack add type d
map .f filter_stack add type f
map .l filter_stack add type l
map .n console filter_stack add name%space
map .m console filter_stack add mime%space
map .' filter_stack add duplicate
map ." filter_stack add unique
map .| filter_stack add or
map .& filter_stack add and
map .! filter_stack add not
map .p filter_stack pop
map .c filter_stack clear
map .. filter_stack show
map .r filter_stack rotate
map .* filter_stack decompose

# Bookmarks
map b<any>  set_bookmark %any
map B<any>  unset_bookmark %any
map '<any>  enter_bookmark %any

map b<bg> draw_bookmarks
copymap b<bg> B<bg> '<bg>

# ===================================================================
# == Define keys for the console
# ===================================================================
# Note: Unmapped keys are passed directly to the console.

# Basic
cmap <Tab>    eval fm.ui.console.tab()
cmap <S-Tab>  eval fm.ui.console.tab(-1)
cmap <ESC>    eval fm.ui.console.close()
cmap <CR>     eval fm.ui.console.execute()

# Move around
cmap <C-u>  eval fm.ui.console.history_move(-1)
cmap <C-e>  eval fm.ui.console.history_move(1)
cmap <C-n>  eval fm.ui.console.move(left=1)
cmap <C-i>  eval fm.ui.console.move(right=1)
cmap <C-b>  eval fm.ui.console.move_word(left=1)
cmap <C-h>  eval fm.ui.console.move_word(right=1)

# Line Editing
cmap <backspace>  eval fm.ui.console.delete(-1)
cmap <delete>     eval fm.ui.console.delete(0)
cmap <C-w>        eval fm.ui.console.delete_word()
cmap <C-u>        eval fm.ui.console.delete_rest(-1)

# This special expression allows typing in numerals:
cmap <allow_quantifiers> false

# ===================================================================
# == Pager Keybindings
# ===================================================================

# Movement
pmap u  pager_move  up=1
pmap U  pager_move  up=5
pmap e  pager_move  down=1
pmap E  pager_move  down=5
pmap n  pager_move  left=4
pmap i  pager_move  right=4
pmap g  pager_move  to=0
pmap G  pager_move  to=-1

# Basic
pmap <ESC> pager_close
pmap q     pager_close
pmap k     edit_file

# ===================================================================
# == Taskview Keybindings
# ===================================================================

# Movement
tmap u  taskview_move up=1
tmap U  taskview_move up=5
tmap e  taskview_move down=1
tmap E  taskview_move down=5
tmap g  taskview_move to=0
tmap G  taskview_move to=-1

# Changing priority and deleting tasks
tmap [  eval -q fm.ui.taskview.task_move(-1)
tmap ]  eval -q fm.ui.taskview.task_move(0)
tmap x  eval -q fm.ui.taskview.task_remove()

# Basic
tmap <ESC> taskview_close
tmap q taskview_close

